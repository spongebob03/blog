{{ define "body-class" }}template-archives{{ end }}
{{ define "main" }}
    {{- $taxonomy := $.Site.GetPage "taxonomyTerm" "categories" -}}
    {{- $terms := $taxonomy.Pages -}}
    {{ if $terms }}
    <section class="widget archives">
    <div class="widget-icon">
        {{ partial "helper/icon" "infinity" }}
    </div>
    <h2 class="section-title" style="color: #b1d3c5;">{{ $taxonomy.Title }}</h2>
    <div class="subsection-list">
        <div class="subsection-list--compact">
            {{ range $terms }}
                {{ partial "article-list/tile" (dict "context" . "size" "250x150" "Type" "taxonomy") }}
            {{ end }}
        </div>
    </div>
    </section>
    {{ end }}

<!--연도별-->
    {{- $query := first 1 (where .Site.Pages "Layout" "==" "archives") -}}
    {{- if $query -}}
    {{- $archivesPage := index $query 0 -}}
    <section class="widget archives" style="padding-bottom: 20px;">
        <div class="widget-icon">
            {{ partial "helper/icon" "date" }}
        </div>
        <h2 class="widget-title section-title">YEAR</h2>

        {{ $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
        {{ $notHidden := where .Site.RegularPages "Params.hidden" "!=" true }}
        {{ $filtered := ($pages | intersect $notHidden) }}
        {{ $archives := $filtered.GroupByDate "2006" }}
        
        <div class="widget-archive--list">
            {{ range $index, $item := first (add .Site.Params.widgets.archives.limit 1) ($archives) }}
                {{- $id := lower (replace $item.Key " " "-") -}}
                <div class="archives-year">
                    <a href="{{ $archivesPage.RelPermalink }}#{{ $id }}">
                        {{ if eq $index $.Site.Params.widgets.archives.limit }}
                            <span class="year">{{ T "widget.archives.more" }}</span>
                        {{ else }}
                            <span class="year">{{ .Key }}</span>
                            <span class="count">{{ len $item.Pages }}</span>
                        {{ end }}
                    </a> 
                </div>
            {{ end }}
        </div>
    </section>
    {{- else -}}
        {{- warnf "Archives page not found. Create a page with layout: archives." -}}
    {{- end -}}
<!---->

    {{ $pages := where .Site.RegularPages "Type" "in" .Site.Params.mainSections }}
    {{ $notHidden := where .Site.RegularPages "Params.hidden" "!=" true }}
    {{ $filtered := ($pages | intersect $notHidden) }}

    {{ range $filtered.GroupByDate "2006" }}
    {{ $id := lower (replace .Key " " "-") }}
    <div class="archives-group" id="{{ $id }}">
        <h2 class="archives-date section-title"><a href="{{ $.RelPermalink }}#{{ $id }}">{{ .Key }}</a></h2>
        <div class="article-list--compact">
            {{ range .Pages }}
                {{ partial "article-list/compact" . }}
            {{ end }}
        </div>
    </div>
    {{ end }}

    {{ partialCached "footer/footer" . }}
{{ end }}
